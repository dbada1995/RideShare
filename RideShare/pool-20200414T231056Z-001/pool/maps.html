<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="maps.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
    <link rel="stylesheet" type="text/css" href="dist/bootstrap-clockpicker.min.css">
    <script type="text/javascript" src="dist/bootstrap-clockpicker.min.js"></script>

    <title>Uber</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
	  </head>
  <body>
	<a class="navbar-brand fas fa-car" href="#">Friendly Rides</a>
    <div class="container" id='mapsheader' style="background:lightgray;width: 100%;height: auto !important;padding-bottom: 9px;padding-top: 7px;"> 
	<form method = 'Get' action = 'Logout'>
	<input type='submit' style='float: right;height: 20px margin: 20px; margin-right: 10px;' value='Logout'></input> 
	</form>
		<button onclick="search1()" style='float: right;height: 20px margin: 20px; margin-right: 10px;'>Search ride</button> 
		<button onclick="post1()" style='float: right;height: 20px margin: 20px; margin-right: 10px;'>Post ride</button> 
	
		<form method = 'Get' action= 'MapView'>
		<input type='submit' style='float: right;height: 20px margin: 20px; margin-right: 10px;' value='View Posted rides'></input> 
		</form>
	</div>
    <div class="container" id="home_page" style = "margin-top:5px">
      <div class="row"> 
	  
  <div class="col-sm-2" style="padding: 0px;" id = "searchride"> 
   <div class="container" style="
    width: 100% !important;
    padding: 0px; margin-top:3px">
    <div class="row" style="margin-left:-5px;">
	<form action = 'SearchTrip' method = 'Get'> 
 
	<div class = "col-sm-4" style = "font-weight:bold; padding-right:0px;">
      Source
    </div>
	<div class ="col-sm-8">
	 <input type="textbox" id="source" name="source" style="width:100%;">
	 </div>
	 </div>
	 <div class="row" style = "margin-top:8px; margin-left:-5px">
	 <div class = "col-sm-4" style = "font-weight:bold; padding-right:0px;">
	 Destination
	 </div>
    <div class = "col-sm-8">
      
      <input type="textbox" id="destination" name="destination" style="width:100%;">
    </div>
	</div>
	</div>
	<div class = "col-sm-12" style="margin-top:23px;">
	
   <button class="show_route btn btn-primary" onclick="searchRide()">Search Ride</button>
	
	<input type='submit'  class="show_route btn btn-primary " id='search1' value='Search ride' style='float: right;height: 20px margin: 20px; margin-right: 10px; margin-top:3px; display: none'></input>
	
	  </form>
	   <button class="show_route btn btn-primary"  onclick="codeAddress(false)">Show route</button>
	</div>
	
	
  </div>
  
  
  <form action = 'MapView?check1=insert' method = 'Post'> 
  <div class="col-sm-2 hide" id = "postride">
   <div class="container" style="width: 100% !important;padding: 0px !important;">
    <div class="row">
      <div class="col-sm-3">
        <span>From</span>
      </div>
      <div class="col-sm-9">
        <input type="textbox" name="source1" id="source1" style="width: 100% !important">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <span>To</span>
      </div>
      <div class="col-sm-9">
        <input type="textbox" name="destination1" id="des1" style="width: 100% !important">
      </div>
    </div>
	<button type='button' name='mapblob' id='mapblob' data-toggle='modal' data-target='#myModal' >Confirm Route</button>
	<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Modal Header</h4>
        </div>
		
        <div class="modal-body">
		<div style='width: 20%; float:left; font-weight:bold;'>
		Meeting Point </div><div style='width: 80%; float:right'> <input type="textbox" id="sourcea" name="sourcea" style="width:100%;"></div>
         <div style='width: 20%; float:left;font-weight:bold'>Dropping point </div><div style='width: 80%; float:right'><input type="textbox" id="destinationa" name="destinationa" style="width:100%;"> </div>
		 <br>
		 <button type='button' class="btn btn-default" onclick="codeAddress(true)" data-dismiss="modal">Ok</button>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
    <div class="row">
      <div class="col-sm-3">
        <span>Date</span>
      </div>
      <div class="col-sm-9">
        <input class="datepicker" name = "d1" style="width: 100% !important">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <span>Time</span>
      </div>
      <div class="col-sm-9 input-group clockpicker" style="padding-left: 15px;padding-right: 15px">
        <input type="text" class="form-control" name = "c1" style="width: 100% !important">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <span>Seats</span>
      </div>
      <div class="col-sm-9">
        <input type="textbox" name="seats" id="seats" style="width: 100% !important">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <span>Message</span>
      </div>
      <div class="col-sm-9">
        <textarea name="message" value="" style="width: 100% !important"></textarea>
      </div>
    </div>
    <div class="col-sm-12" style="padding: 0px">
      <div class="col-sm-5" style="padding: 0px"> 
        <span>Expenses</span>
      </div>  
      <div class="col-sm-7" style="padding: 0px">
          <input type="radio" name="charge" value="gas"> Gas
          <input type="radio" name="charge" value="Cash">Cash       
      </div>
    </div>
    <input type='submit' name='Post Ride' value='post ride' style='float: right;height: 20px margin: 20px; margin-right: 10px;'></input>
  </div>
   </form>
  </div>
  
  <div class="col-sm-10 height_100_percent">
    <div id="map"></div>
  </div>
</div>

    </div>
    <script>
      var map;
      var geocoder;
      function initMap() {
        geocoder = new google.maps.Geocoder();
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15
        });
        infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            // infoWindow.setPosition(pos);
            // infoWindow.open(map);
            map.setCenter(pos);
            var marker = new google.maps.Marker({
              position: pos,
              map: map,
            });
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }

      function displayRoute(source,destination) {
        // var start = new google.maps.LatLng(12.9654, 80.2461);
        // var end = new google.maps.LatLng(12.9416, 80.2362);

        var directionsDisplay = new google.maps.DirectionsRenderer();// also, constructor can get "DirectionsRendererOptions" object
        directionsDisplay.setMap(map); // map should be already initialized.

        var request = {
            origin : source,
            destination : destination,
            travelMode : google.maps.TravelMode.DRIVING
        };
        var directionsService = new google.maps.DirectionsService(); 
        directionsService.route(request, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
            }
        });
      }

      function codeAddress(val) {
	  var source,destination;
		if(val){
        
        source_address = document.getElementById('sourcea').value;
        destination_address = document.getElementById('destinationa').value;
		}else{
		source_address = document.getElementById('source').value;
        destination_address = document.getElementById('destination').value;
		
		}
        geocoder.geocode( { 'address': source_address}, function(results, status) {
          if (status == 'OK') {
            source = results[0].geometry.location
            geocoder.geocode( { 'address': destination_address}, function(results, status) {
              if (status == 'OK') {
                destination = results[0].geometry.location;
                displayRoute(source,destination);
              } else {
                alert('Geocode was not successful for the following reason: ' + status);
              }
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }   
	  function search1(){
			$("#postride").addClass('hide');
			$("#searchride").removeClass('hide');
			
	  }
	   function post1(){
			$("#searchride").addClass('hide');
			$("#postride").removeClass('hide');
	  }
	 function searchRide(){
		$("#search1").submit();
	 }
	 
     
    </script>
	

    <script type="text/javascript">
      $(document).ready(function(){
        var date_input = $('.datepicker'); //our date input has the name "date"
        var options = {
          format: 'mm/dd/yyyy',
          todayHighlight: true,
          autoclose: true,
        };
        date_input.datepicker(options);
        $('.clockpicker').clockpicker({
          donetext: 'Done'
        });
      })
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB7J1zsErb9_7jxNu5KU5kIENFObAQEbl0&callback=initMap"
    async defer></script>
  </body>
</html>